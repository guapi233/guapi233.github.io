# ç¬¬ 8 ç«  å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼

å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼åˆå«è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚åœ¨JavaScriptå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨äº‹ä»¶æ¨¡å‹æ¥ä»£æ›¿ä¼ ç»Ÿçš„å‘å¸ƒâ€”è®¢é˜…æ¨¡å‹ã€‚



## 8.1 ç°å®ä¸­çš„å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼

å°æ˜ã€å°çº¢å’Œå°åˆšéƒ½æƒ³ä¹°æˆ¿å­ï¼Œäºæ˜¯å”®æ¥¼MMè®°ä¸‹äº†ä»–ä»¬çš„ç”µè¯ï¼Œç­‰æœ‰æˆ¿å­çš„æ—¶å€™é€šçŸ¥ä»–ä»¬ã€‚



## 8.2 å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼çš„ä½œç”¨

- å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼å¯ä»¥å¹¿æ³›åº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œè¿™æ˜¯ä¸€ç§æ›¿ä»£ä¼ é€’å›è°ƒå‡½æ•°çš„æ–¹æ¡ˆã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¢é˜…`ajax`è¯·æ±‚çš„`error`ã€`success`ç­‰äº‹ä»¶ã€‚æˆ–è€…å¦‚æœæƒ³åœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§å®Œæˆä¹‹ååšä¸€äº›äº‹æƒ…ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è®¢é˜…ä¸€ä¸ªäº‹ä»¶ï¼Œç„¶ååœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§å®Œæˆä¹‹åå‘å¸ƒè¿™ä¸ªäº‹ä»¶ã€‚åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ä½¿ç”¨å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼ï¼Œæˆ‘ä»¬å°±æ— éœ€è¿‡å¤šå…³æ³¨å¯¹è±¡åœ¨å¼‚æ­¥è¿è¡ŒæœŸé—´çš„å†…éƒ¨çŠ¶æ€ï¼Œè€Œåªéœ€è¦è®¢é˜…æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿç‚¹ã€‚
- å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼å¯ä»¥å–ä»£å¯¹è±¡ä¹‹é—´ç¡¬ç¼–ç çš„é€šçŸ¥æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡ä¸ç”¨å†æ˜¾å¼åœ°è°ƒç”¨å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªæ¥å£ã€‚å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼è®©ä¸¤ä¸ªå¯¹è±¡æ¾è€¦åˆåœ°è”ç³»åœ¨ä¸€èµ·ï¼Œè™½ç„¶ä¸å¤ªæ¸…æ¥šå½¼æ­¤çš„ç»†èŠ‚ï¼Œä½†è¿™ä¸å½±å“å®ƒä»¬ä¹‹é—´ç›¸äº’é€šä¿¡ã€‚å½“æœ‰æ–°çš„è®¢é˜…è€…å‡ºç°æ—¶ï¼Œå‘å¸ƒè€…çš„ä»£ç ä¸éœ€è¦ä»»ä½•ä¿®æ”¹;åŒæ ·å‘å¸ƒè€…éœ€è¦æ”¹å˜æ—¶ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°ä¹‹å‰çš„è®¢é˜…è€…ã€‚åªè¦ä¹‹å‰çº¦å®šçš„äº‹ä»¶åæ²¡æœ‰å˜åŒ–ï¼Œå°± å¯ä»¥è‡ªç”±åœ°æ”¹å˜å®ƒä»¬ã€‚



## 8.3 DOMäº‹ä»¶

```js
  let b = document.body;

  b.onclick = function () {
    console.log("??")
  }

  b.click()
  b.click()
  b.click()
  b.click()
```



## 8.4 è‡ªå®šä¹‰äº‹ä»¶

å¦‚ä½•å®ç°å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼ï¼š

* é¦–å…ˆè¦æŒ‡å®šå¥½è°å……å½“å‘å¸ƒè€…ï¼›
* ç„¶åç»™å‘å¸ƒè€…æ·»åŠ ä¸€ä¸ªç¼“å­˜åˆ—è¡¨ï¼Œç”¨äºå­˜æ”¾å›è°ƒå‡½æ•°ä»¥ä¾¿é€šçŸ¥è®¢é˜…è€…ï¼›
* æœ€åå‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™ï¼Œå‘å¸ƒè€…ä¼šéå†è¿™ä¸ªç¼“å­˜åˆ—è¡¨ï¼Œä¾æ¬¡è§¦å‘é‡Œé¢å­˜æ”¾çš„è®¢é˜…è€…å›è°ƒå‡½æ•°ã€‚

```js
var salesOffices = {}; // å®šä¹‰å‘å¸ƒè€…

salesOffices.clientList = []; // ç¼“å­˜åˆ—è¡¨ï¼Œå­˜æ”¾è®¢é˜…è€…çš„å›è°ƒå‡½æ•°

salesOffices.listen = function (fn) { // æ·»åŠ è®¢é˜…è€…
    this.clientList.push(fn); // è®¢é˜…çš„æ¶ˆæ¯æ·»åŠ è¿›ç¼“å­˜åˆ—è¡¨
};

salesOffices.trigger = function () {
    for (var i = 0, fn; fn = salesOffices.clientList[i++];) {
        fn.apply(this, arguments); // argumentsæ˜¯å‘å¸ƒæ¶ˆæ¯æ—¶å¸¦ä¸Šçš„å‚æ•°
    }
};
```

è°ƒç”¨

```js
salesOffices.listen(function (price, squareMeter) { // å°æ˜è®¢é˜…æ¶ˆæ¯
    console.log(`ä»·æ ¼æ˜¯ï¼š${price}`);
    console.log(`é¢ç§¯æ˜¯ï¼š${squareMeter}`);
})

salesOffices.listen(function (price, squareMeter) { // å°çº¢è®¢é˜…æ¶ˆæ¯
    console.log(`ä»·æ ¼æ˜¯ï¼š${price}`);
    console.log(`é¢ç§¯æ˜¯ï¼š${squareMeter}`);
})

salesOffices.trigger(2000000, 88);
salesOffices.trigger(3000000, 110);
```

ä¸Šé¢çš„ä»£ç æœ‰ä¸€ç‚¹é—®é¢˜ï¼Œå‘å¸ƒè€…ä¼šå°†ä¸¤æ¡ä¿¡æ¯åˆ†åˆ«å‘é€ç»™ä¸¤ä½è®¢é˜…è€…ï¼Œä½†æ˜¯ å°æ˜åªæƒ³å…³æ³¨88å¹³æˆ¿å­çš„æ¶ˆæ¯ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨è®¢é˜…æ—¶åŠ ä¸Šç‚¹é€‰é¡¹ï¼š

```js
var salesOffices = {}; // å®šä¹‰å”®æ¥¼å¤„

salesOffices.clientList = {}; // ç¼“å­˜å¯¹è±¡ï¼Œç”¨äºå­˜å–è®¢é˜…è€…çš„å›è°ƒå‡½æ•°

salesOffices.listen = function (key, fn) {
    if (!salesOffices.clientList[key]) {
        salesOffices.clientList[key] = [];
    }

    salesOffices.clientList[key].push(fn);
}

salesOffices.trigger = function (key) {
    for (var i = 0, fn; fn = salesOffices.clientList[key][i++];) {
        fn.apply(this, arguments);
    }
};

// è°ƒç”¨

salesOffices.listen("88", function () { // å°æ˜è®¢é˜…äº†88å¹³æˆ¿å­çš„æ¶ˆæ¯
    console.log("88å¹³æˆ¿æœ‰è´§å•¦ï¼");
})

salesOffices.listen("110", function () { // å°çº¢è®¢é˜…äº†110å¹³æˆ¿å­çš„æ¶ˆæ¯
    console.log("110å¹³æˆ¿æœ‰è´§å•¦ï¼");
})

salesOffices.trigger("88");
salesOffices.trigger("110");
```



## 8.5 å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼çš„é€šç”¨å®ç°

ç°åœ¨æŠŠå‘å¸ƒâ€”è®¢é˜…åŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œç»™å…¶å®ƒå¯¹è±¡åŠ¨æ€æ·»åŠ å‘å¸ƒâ€”è®¢é˜…çš„æ•ˆæœï¼š

```js
var event = {
    clientList: {},
    listen: function (key, fn) {
        if (!this.clientList[key]) {
            this.clientList[key] = [];
        }

        this.clientList[key].push(fn);
    },
    trigger: function () {
        var key = Array.prototype.shift.call(arguments),
            fns = this.clientList[key];

        if (!fns || fns.length === 0) { // å¦‚æœæ²¡æœ‰ç»‘å®šçš„æ¶ˆæ¯
            return false;
        }

        for (var i = 0, fn; fn = fns[i++];) {
            fn.apply(this, arguments);
        }
    }
}

// å®‰è£…å™¨ï¼Œç»™å¯¹è±¡èº«ä¸Šå®‰è£…å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼
var installEvent = function (obj) {
    for (var i in event) {
        obj[i] = event[i];
    }
};

// è°ƒç”¨
var a = {}

// ç»™å¯¹è±¡aå®‰è£…å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼
installEvent(a);

a.listen("sum", function (a, b) {
    console.log(a + b);
})

a.trigger("sum", 18, 16);
```



## å–æ¶ˆè®¢é˜…çš„äº‹ä»¶

```js
var event = {
    clientList: {},
    listen: function (key, fn) {
        if (!this.clientList[key]) {
            this.clientList[key] = [];
        }

        this.clientList[key].push(fn);
    },
    trigger: function () {
        var key = Array.prototype.shift.call(arguments),
            fns = this.clientList[key];

        if (!fns || fns.length === 0) { // å¦‚æœæ²¡æœ‰ç»‘å®šçš„æ¶ˆæ¯
            return false;
        }

        for (var i = 0, fn; fn = fns[i++];) {
            fn.apply(this, arguments);
        }
    },
    remove: function (key, fn) {
        var fns = this.clientList[key];

        if (!fns || fns.length === 0) { // å¦‚æœkeyå¯¹åº”çš„æ¶ˆæ¯æ²¡æœ‰è¢«è®¢é˜…è¿‡ï¼Œåˆ™ç›´æ¥è¿”å›
            return false;
        }

        if (!fn) { // å¦‚æœæ²¡æœ‰ä¼ å…¥å…·ä½“å›è°ƒå‡½æ•°ï¼Œåˆ™å–æ¶ˆkeyå¯¹åº”æ¶ˆæ¯çš„æ‰€æœ‰è®¢é˜…
            fns && (fns.length = 0);
        } else {
            // åå‘éå†æ˜¯å› ä¸ºï¼Œspliceæ–¹æ³•ä¼šä¿®æ”¹æ•°ç»„çš„ä¸‹æ ‡ï¼Œæ­£å‘éå†ä¼šå¯¼è‡´éƒ¨åˆ†å…ƒç´ æ— æ³•è¢«éå†åˆ°
            for (var l = fns.length-1; l >= 0; l--) { 
                var _fn = fns[l];

                if (_fn === fn) {
                    fns.splice(l, 1);
                }
            }
        }
        
    }
}

// å®‰è£…å™¨ï¼Œç»™å¯¹è±¡èº«ä¸Šå®‰è£…å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼
var installEvent = function (obj) {
    for (var i in event) {
        obj[i] = event[i];
    }
};

// è°ƒç”¨
var a = {}

// ç»™å¯¹è±¡aå®‰è£…å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼
installEvent(a);
var cb =  function (a, b) {
    console.log(a + b);
};

a.listen("sum", cb)

a.trigger("sum", 18, 16); // 34
a.remove("sum", cb)
a.trigger("sum", 18, 16); // æ²¡æœ‰è§¦å‘

```



## 8.7 çœŸå®çš„ä¾‹å­â€”â€”ç½‘ç«™ç™»å½•

ä¸¾äº†ä¸€ä¸ªç°å®å¼€å‘ä¸­çš„ä¾‹å­ï¼Œç½‘é¡µåŠ è½½ç”¨æˆ·ä¿¡æ¯ä¹‹åé€šçŸ¥è®¢é˜…äº†è¯¥æ¶ˆæ¯çš„ç»„ä»¶ï¼Œæ›´æ–°å®ƒä»¬çš„çŠ¶æ€ã€‚



## 8.8 å…¨å±€çš„å‘å¸ƒâ€”è®¢é˜…å¯¹è±¡

è™½ç„¶åŸºæœ¬å®ç°äº†å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä½†æ˜¯ç°åœ¨è¿˜æœ‰ä¸€äº›ç¼ºé™·ï¼š

- æˆ‘ä»¬ç»™æ¯ä¸ªå‘å¸ƒè€…å¯¹è±¡éƒ½æ·»åŠ äº†`listen`å’Œ`trigger`æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªç¼“å­˜åˆ—è¡¨`clientList`ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§èµ„æºæµªè´¹ã€‚
- å¿…é¡»çŸ¥é“å‘å¸ƒè€…çš„åå­—å«`salesOffices`ï¼Œä¸€æ—¦æƒ³è®¢é˜…å¦å¤–ä¸€ä¸ªå‘å¸ƒè€…ï¼Œæˆ‘ä»¬å¾—å†ç²˜ä¸€æ¬¡ä»£ç ã€‚

å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼å¯ä»¥ç”¨ä¸€ä¸ªå…¨å±€çš„`Event`å¯¹è±¡æ¥å®ç°ï¼Œè®¢é˜…è€…ä¸éœ€è¦äº†è§£æ¶ˆæ¯æ¥è‡ªå“ªä¸ªå‘å¸ƒè€…ï¼Œå‘å¸ƒè€…ä¹Ÿä¸çŸ¥é“æ¶ˆæ¯ä¼šæ¨é€ç»™å“ªäº›è®¢é˜…è€…ï¼Œ`Event`ä½œä¸ºä¸€ä¸ªç±»ä¼¼`ä¸­ä»‹è€…`çš„è§’è‰²ï¼ŒæŠŠ`è®¢é˜…è€…`å’Œ`å‘å¸ƒè€…`è”ç³»èµ·æ¥

ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„`Event`å¯¹è±¡ï¼ˆå”¯ä¸€ä¸€ä¸ªï¼‰ï¼š

```js
var Event = (function () {
    var clientList = {},
        listen,
        trigger,
        remove;

    listen = function (key, fn) {
        if (!clientList[key]) {
            clientList[key] = [];
        }

        clientList[key].push(fn);
    }

    trigger = function () {
        var key = Array.prototype.shift.call(arguments),
            fns = clientList[key];

        if (!fns || fns.length === 0) {
            return false;
        } 

        for (var i = 0, fn; fn = fns[i++];) {
            fn.apply(this, arguments);
        }
    }

    remove = function (key, fn) {
        var fns = clientList[key];

        if (!fns || fns.length === 0) {
            return false;
        }

        if (!fn) {
            fns && (fns.length = 0);
        } else {
            for (var l = fns.length; l >= 0; l--) {
                var _fn = fns[l];

                if (_fn === fn) {
                    fns.splice(l, 1);
                }
            }
        }
    }

    return {
        listen,
        trigger,
        remove
    }
})()

Event.listen("hah", aa = function () {
    console.log("ahha")
})

Event.trigger("hah");
Event.remove("hah", aa);
Event.trigger("hah");
```



## 8.9 æ¨¡å—é—´é€šä¿¡

ç‚¹å‡»æŒ‰é’®ï¼Œå±•ç¤ºç‚¹å‡»çš„æ¬¡æ•°ï¼š

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <button id="btn">ç‚¹æˆ‘</button>
  <div id="show">ç‚¹äº†0æ¬¡</div>
</body>
<script>
  var Event = (function () {
    var clientList = {},
      listen,
      trigger,
      remove;

    listen = function (key, fn) {
      if (!clientList[key]) {
        clientList[key] = [];
      }

      clientList[key].push(fn);
    }

    trigger = function () {
      var key = Array.prototype.shift.call(arguments),
        fns = clientList[key];

      if (!fns || fns.length === 0) {
        return false;
      }

      for (var i = 0, fn; fn = fns[i++];) {
        fn.apply(this, arguments);
      }
    }

    remove = function (key, fn) {
      var fns = clientList[key];

      if (!fns || fns.length === 0) {
        return false;
      }

      if (!fn) {
        fns && (fns.length = 0);
      } else {
        for (var l = fns.length; l >= 0; l--) {
          var _fn = fns[l];

          if (_fn === fn) {
            fns.splice(l, 1);
          }
        }
      }
    }

    return {
      listen,
      trigger,
      remove
    }
  })()

  var btn = (function () {
    var _btn = document.querySelector("#btn");
    var count = 0;

    _btn.onclick = function () {
      Event.trigger("_btn", ++count);
    }

    return _btn;
  })()

  var show = (function () {
    var _show = document.querySelector("#show");

    Event.listen("_btn", function (count) {
      _show.innerHTML = `ç‚¹å‡»äº†${count}æ¬¡`;
    })

    return _show;
  })()
</script>

</html>
```

ä½†è¿™é‡Œæˆ‘ä»¬è¦ç•™æ„ä¸€ä¸ªé—®é¢˜ï¼Œæ¨¡å—ä¹‹é—´å¦‚æœç”¨äº†å¤ªå¤šçš„å…¨å±€å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼æ¥é€šä¿¡ï¼Œé‚£ä¹ˆæ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„è”ç³»å°±è¢«éšè—åˆ°äº†èƒŒåã€‚æˆ‘ä»¬æœ€ç»ˆä¼šæä¸æ¸…æ¥šæ¶ˆæ¯æ¥è‡ªå“ªä¸ªæ¨¡å—ï¼Œæˆ–è€…æ¶ˆæ¯ä¼šæµå‘å“ªä¸ªæ¨¡å—ï¼Œè¿™åˆä¼šç»™æˆ‘ä»¬çš„ç»´æŠ¤å¸¦æ¥ä¸€äº›éº»çƒ¦ï¼Œä¹Ÿè®¸æŸä¸ªæ¨¡å—çš„ä½œç”¨å°±æ˜¯æš´éœ²ä¸€äº›æ¥å£ç»™å…¶ä»–æ¨¡å—è°ƒç”¨ã€‚



## 8.10 å¿…é¡»å…ˆè®¢é˜…åœ¨å‘å¸ƒå—

ä¸ä¸€å®šï¼

å»ºç«‹ä¸€ä¸ªå­˜æ”¾ç¦»çº¿äº‹ä»¶çš„å †æ ˆï¼Œå½“äº‹ä»¶å‘å¸ƒçš„æ—¶å€™ï¼Œå¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰è®¢é˜…è€…æ¥è®¢é˜…è¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬æš‚æ—¶æŠŠå‘å¸ƒäº‹ä»¶çš„åŠ¨ä½œåŒ…è£¹åœ¨ä¸€ä¸ªå‡½æ•°é‡Œï¼Œè¿™äº›åŒ…è£…å‡½æ•°å°†è¢«å­˜å…¥å †æ ˆä¸­ï¼Œç­‰åˆ°ç»ˆäºæœ‰å¯¹è±¡æ¥è®¢é˜…æ­¤äº‹ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†éå†å †æ ˆå¹¶ä¸”ä¾æ¬¡æ‰§è¡Œè¿™äº›åŒ…è£…å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯é‡æ–°å‘å¸ƒé‡Œé¢çš„äº‹ä»¶ã€‚å½“ç„¶ç¦»çº¿äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸€æ¬¡ï¼Œå°±åƒ`QQ`çš„æœªè¯»æ¶ˆæ¯åªä¼šè¢«é‡ æ–°é˜…è¯»ä¸€æ¬¡ï¼Œæ‰€ä»¥åˆšæ‰çš„æ“ä½œæˆ‘ä»¬åªèƒ½è¿›è¡Œä¸€æ¬¡ã€‚

è¿™ä¹ˆåšå¾—åŸå› æ˜¯æœ‰å¯èƒ½æ¶ˆæ¯å‘å¸ƒäº†ï¼Œç„¶è€Œæ²¡æœ‰è®¢é˜…è€…ï¼Œå®é™…ä¸Šï¼Œç¡®å®å­˜åœ¨è¿™ç§ç°è±¡ï¼Œé‚£ä¸Šé¢çš„ç”¨æˆ·ä¿¡æ¯è¯·æ±‚è·ç¦»ï¼Œå¾ˆæœ‰å¯èƒ½ç”¨æˆ·ä¿¡æ¯è¯·æ±‚åˆ°äº†ï¼Œæ¶ˆæ¯å‘å¸ƒå‡ºå»äº†ï¼Œç„¶è€Œï¼Œéœ€è¦å±•ç¤ºç”¨æˆ·ä¿¡æ¯çš„æ¨¡å—è¿˜æ²¡åŠ è½½å‡ºæ¥ï¼Œç‰¹åˆ«æ˜¯ç”¨äº†æ‡’åŠ è½½ç‰¹æ€§ï¼Œæ›´æœ‰å¯èƒ½å‘ç”Ÿè¿™ç§çŠ¶å†µã€‚



## 8.11 å…¨å±€äº‹ä»¶çš„å‘½åå†²çª

<font color="eb2f06">ğŸ˜¢ï¼š æœ€ç»ˆç‰ˆçš„ä»£ç å¾ˆé•¿ï¼Œè¿˜æ²¡æœ‰æ³¨é‡Šã€‚ä¸‹é¢æ˜¯ä»¿å†™çš„ä»£ç ï¼Œä¸è¿‡å®ƒæœ‰bugã€‚</font>

```js
var Event = (function () {
    var global = this,
        Event,
        _default = "default";

    Event = function () {
        var _listen,
            _trigger,
            _remove,
            _slice = Array.prototype.slice,
            _shift = Array.prototype.shift,
            _unshift = Array.prototype.unshift,
            namespaceCache = {},
            _create,
            find,
            each = function (ary, fn) {
                var ret;
                for (var i = 0, l = ary.length; i < l; i++) {
                    var n = ary[i];
                    ret = fn.call(n, i, n);
                }

                return ret;
            };

        _listen = function (key, fn, cache) {
            if (!cache[key]) {
                cache[key] = [];
            }

            cache[key].push(fn)
        }

        _remove = function (key, cache, fn) {
            if (cache[key]) {
                if (fn) {
                    for (var i = cache[key].length; i >= 0; i--) {
                        if (cachekey === fn) {
                            cache[key].splice(i, 1);
                        }
                    }

                } else {
                    cache[key] = [];
                }

            }

        }

        _trigger = function () {
            var cache = _shift.call(arguments),
                key = _shift.call(arguments),
                args = arguments,
                _self = this,
                ret,
                stack = cache[key];

            if (!stack || !stack.length) {
                return;
            }

            return each(stack, function () {
                return this.apply(_self, args);
            })
        }

        _create = function (namespace) {
            var namespace = namespace || _default;

            var cache = {},
                offlineStack = [], // ç¦»çº¿äº‹ä»¶
                ret = {
                    listen: function (key, fn, last) {
                        _listen(key, fn, cache);

                        if (offlineStack === null) {
                            return;
                        }

                        if (last === "last") {
                            offlineStack.length && offlineStack.pop()();
                        } else {
                            each(offlineStack, function () {
                                console.log(this.toString())
                                this();
                            })
                        }

                        offlineStack = null;
                    },
                    one: function (key, fn, last) {
                        _remove(key, cache);

                        this.listen(key, fn, last);
                    },
                    remove: function (key, fn) {
                        _remove(key, cache, fn);
                    },
                    trigger: function (key, fn) {
                        var fn,
                            args,
                            _self = this;

                        _unshift.call(arguments, cache);
                        args = arguments;
                        fn = function () {
                            return _trigger.apply(_self, args);
                        };

                        if (offlineStack) {
                            return offlineStack.push(fn);
                        }

                        return fn();
                    }
                };

            return namespace ?
            (namespaceCache[namespace] ?namespaceCache[namespace] :
                namespaceCache[namespace] = ret)
                :ret;
        };

        return {
            create: _create,
            one: function (key, fn, last) {
                var event = this.create();
                event.one(key, fn, last);
            },
            remove: function (key, fn) {
                var event = this.create();
                event.remove(key, fn);
            },
            listen: function (key, fn, last) {
                var event = this.create();
                console.log(key, fn, last)
                event.listen(key, fn, last);
            },
            trigger: function () {
                var event = this.create();
                event.trigger.apply(this, arguments);
            }
        }
    }();

    return Event;
})()


// è°ƒç”¨
Event.trigger("click", 1);

Event.listen("click", function (a) {
    console.log(a)
})
```



## 8.12 JavaScriptå®ç°å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼çš„ä¾¿åˆ©æ€§

æ­¤å°èŠ‚å’ŒJavaä¸­çš„å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼åšäº†ä¸€äº›å¯¹æ¯”ã€‚



## 8.13 å°ç»“

å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼çš„ä¼˜ç‚¹éå¸¸æ˜æ˜¾ï¼Œä¸€ä¸ºæ—¶é—´ä¸Šçš„è§£è€¦ï¼ŒäºŒä¸ºå¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚å®ƒçš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæ—¢å¯ä»¥ç”¨åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆæ›´æ¾è€¦åˆçš„ä»£ç ç¼–å†™ã€‚å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼è¿˜å¯ä»¥ç”¨æ¥å¸®åŠ©å®ç°ä¸€äº›åˆ«çš„è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚ä¸­ä»‹è€…æ¨¡å¼ã€‚ä»æ¶æ„ä¸Šæ¥çœ‹ï¼Œæ— è®ºæ˜¯ MVC è¿˜æ˜¯ MVVMï¼Œ éƒ½å°‘ä¸äº†å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼çš„å‚ä¸ï¼Œè€Œä¸”`JavaScript`æœ¬èº«ä¹Ÿæ˜¯ä¸€é—¨åŸºäºäº‹ä»¶é©±åŠ¨çš„è¯­è¨€ã€‚

å½“ç„¶ï¼Œå‘å¸ƒâ€”è®¢é˜…æ¨¡å¼ä¹Ÿä¸æ˜¯å®Œå…¨æ²¡æœ‰ç¼ºç‚¹ï¼ˆæµªè´¹å†…å­˜ï¼‰ã€‚åˆ›å»ºè®¢é˜…è€…æœ¬èº«è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´å’Œå†…å­˜ï¼Œè€Œä¸”å½“ä½ è®¢é˜…ä¸€ä¸ªæ¶ˆæ¯åï¼Œä¹Ÿè®¸æ­¤æ¶ˆæ¯æœ€åéƒ½æœªå‘ç”Ÿï¼Œä½†è¿™ä¸ªè®¢é˜…è€…ä¼šå§‹ç»ˆå­˜åœ¨äºå†…å­˜ä¸­ã€‚å¦å¤–ï¼Œå‘å¸ƒâ€”è®¢é˜…æ¨¡å¼è™½ç„¶å¯ä»¥å¼±åŒ–å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œä½†å¦‚æœè¿‡åº¦ä½¿ç”¨çš„è¯ï¼Œå¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´çš„å¿…è¦è”ç³»ä¹Ÿå°†è¢«æ·±åŸ‹åœ¨èƒŒåï¼Œä¼šå¯¼è‡´ç¨‹åºéš¾ä»¥è·Ÿè¸ªç»´æŠ¤å’Œç†è§£ã€‚ç‰¹åˆ«æ˜¯æœ‰å¤šä¸ªå‘å¸ƒè€…å’Œè®¢é˜…è€…ï¼ˆbè®¢é˜…açš„æ¶ˆæ¯å¹¶å‘å¸ƒç»™cï¼‰åµŒå¥—åˆ°ä¸€èµ·çš„æ—¶å€™ï¼Œè¦è·Ÿè¸ªä¸€ä¸ª`bug`ä¸æ˜¯ä»¶è½»æ¾çš„äº‹æƒ…ã€‚